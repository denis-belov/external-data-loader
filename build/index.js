!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["external-data-loader"]=t():e["external-data-loader"]=t()}(self,(function(){return(()=>{"use strict";var e={d:(t,o)=>{for(var r in o)e.o(o,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:o[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{default:()=>o});const o=class{constructor(){this.content={},this.length=null,this.current=null,this.loaded=null,this.progress=null,this.rejectOnError=!1}getXhr({name:e,type:t,source:o,headers:r,middleware:s},n,a){const l=new XMLHttpRequest;return l.lastLoaded=0,l.image=null,l.lengthComputable=!0,l.loaded=0,o.constructor===ArrayBuffer?(l.image=new Image,l.image.onload=()=>this.onload(l,e,s,n),l.image.src=window.URL.createObjectURL(new Blob([o]))):(l.open("GET",o,!0),"image"===t?(l.responseType="arraybuffer",l.image=new Image):"document"===t?(l.responseType=t,l.overrideMimeType("text/xml")):l.responseType=t,l.setRequestHeader("X-Requested-With","XMLHttpRequest"),l.setRequestHeader("Content-type","text"),r&&Object.keys(r).forEach((e=>l.setRequestHeader(e,r[e]))),l.onprogress=e=>this.onprogress(l,e),l.onload=()=>{200===l.status?"image"===t?(l.image.onload=()=>this.onload(l,e,s,n),l.image.src=window.URL.createObjectURL(new Blob([l.response]))):this.onload(l,e,s,n):this.rejectOnError?a(l):this.onloadBroken(e,n)},l.onerror=e=>a(e),l.send()),l}load(e){return new Promise(((t,o)=>{if(e&&e.sources){this.length=Object.keys(e.sources).length,this.current=0,this.loaded=0,this.progress=e.progress||(()=>0),this.rejectOnError=!1;for(const r in e.sources){const s=e.sources[r];this.content[r]=this.getXhr({name:r,type:s.type||"text",source:s.source||s,headers:e.headers,middleware:s.middleware||null},t,o)}}else o(new Error("external-data-loader ERROR: NO SOURCES"))}))}onprogress(e,t){e.lengthComputable=t.lengthComputable,e.lengthComputable&&(this.loaded+=t.loaded/t.total-e.lastLoaded,e.lastLoaded=t.loaded/t.total,e.loaded=e.lastLoaded,this.progress())}onload(e,t,o,r){this.loaded+=e.lengthComputable?1-e.loaded:1,this.progress();const s=this.content[t],n=s.image||s.response||s.responseText;this.content[t]=o?o(n):n,++this.current===this.length&&(this.loaded=this.length,this.progress(),r(this.content))}onloadBroken(e,t){this.loaded++,this.progress(),this.content[e]=null,++this.current===this.length&&(this.loaded=this.length,this.progress(),t(this.content))}};return t})()}));